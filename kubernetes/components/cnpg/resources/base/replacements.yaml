---
- source:
    kind: HelmRelease
    fieldPath: metadata.name
  targets:
    - select:
        kind: ExternalSecret
        labelSelector: dormammu.io/component=cnpg
      fieldPaths:
        - metadata.name
        - spec.dataFrom.1.extract.key
      options:
        delimiter: "-"
        index: 0

    - select:
        kind: Cluster
      fieldPaths:
        - metadata.name
      options:
        delimiter: "-"
        index: 0

    - select:
        kind: Pooler
      fieldPaths:
        - metadata.name
        - spec.cluster.name
        - spec.template.spec.affinity.podAntiAffinity.requiredDuringSchedulingIgnoredDuringExecution.0.labelSelector.matchExpressions.[key=cnpg.io/cluster].values.0
      options:
        delimiter: "-"
        index: 0
