---
apiVersion: gateway.kgateway.dev/v1alpha1
kind: GatewayExtension
metadata:
  name: ${APP}-oauth
spec:
  oauth2:
    backendRef:
      group: gateway.networking.k8s.io
      kind: HTTPRoute
      name: pocket-id
      namespace: home-infra
    issuerURI: "https://id.${SECRET_DOMAIN}"
    scopes: ["openid", "profile", "email", "groups"]
    credentials:
      clientID: "${CLIENT_ID:=${APP}}"
      clientSecretRef:
        name: ${APP}-oidc-credentials
    cookies:
      domain: "${SECRET_DOMAIN}"
