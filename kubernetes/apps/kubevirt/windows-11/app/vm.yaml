---
apiVersion: kubevirt.io/v1
kind: VirtualMachine
metadata:
  name: windows-11
spec:
  runStrategy: Always
  template:
    spec:
      evictionStrategy: LiveMigrate
      domain:
        clock:
          timer:
            hpet:
              present: false
            hyperv: {}
            pit:
              tickPolicy: delay
            rtc:
              tickPolicy: catchup
          utc: {}
          timezone: ${TZ}
        cpu:
          sockets: 1
          cores: 6
          threads: 1
          model: x86-64-v3
        ioThreadsPolicy: auto
        memory:
          guest: 12Gi
        resources:
          requests:
            cpu: "6"
            memory: "1Gi"
          limits:
            cpu: "6"
            memory: "13Gi"
        devices:
          disks:
            - name: pvcdisk
              disk:
                bus: virtio
            - name: winiso
              cdrom:
                bus: sata
            - name: virtio
              cdrom:
                bus: sata
          interfaces:
            - masquerade: {}
              model: virtio
              name: default
              macAddress: 64:16:7F:30:13:EC
          tpm: {}
        features:
          acpi: {}
          apic: {}
          hyperv:
            relaxed: {}
            spinlocks:
              spinlocks: 8191
            vapic: {}
          smm: {}
        firmware:
          bootloader:
            efi:
              secureBoot: true
      networks:
        - name: default
          pod: {}
      terminationGracePeriodSeconds: 100
      volumes:
        - name: pvcdisk
          persistentVolumeClaim:
            claimName: windows-11
        - name: winiso
          persistentVolumeClaim:
            claimName: windows-11-iso
        - name: virtio
          containerDisk:
            image: quay.io/kubevirt/virtio-container-disk:v1.7.0
