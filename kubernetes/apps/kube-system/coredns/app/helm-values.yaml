---
fullnameOverride: coredns
k8sAppLabelOverride: kube-dns
serviceAccount:
  create: true
service:
  name: kube-dns
  clusterIP: "172.17.0.10"
replicaCount: 1
deployment: false
servers:
  - zones:
      - zone: .
        scheme: dns://
        use_tcp: true
    port: 53
    plugins:
      - name: errors
      - name: health
        configBlock: |-
          lameduck 5s
      - name: ready
      - name: log
        configBlock: |-
          class error
      - name: prometheus
        parameters: 0.0.0.0:9153
      - name: kubernetes
        parameters: cluster.local in-addr.arpa ip6.arpa
        configBlock: |-
          pods insecure
          fallthrough in-addr.arpa ip6.arpa
      - name: forward
        parameters: . blocky.network.svc.cluster.local
      - name: loop
      - name: reload
      - name: loadbalance
podDisruptionBudget:
  enabled: true
  minAvailable: "50%"
affinity:
  podAntiAffinity:
    requiredDuringSchedulingIgnoredDuringExecution:
    - labelSelector:
        matchExpressions:
        - key: k8s-app
          operator: In
          values:
          - coredns
      topologyKey: "kubernetes.io/hostname"
tolerations:
  - key: CriticalAddonsOnly
    operator: Exists
  # - key: node-role.kubernetes.io/control-plane
  #   operator: Exists
  #   effect: NoSchedule
# Graceful Helmfile to HelmRelease takeover
customLabels:
  helm.toolkit.fluxcd.io/name: coredns
  helm.toolkit.fluxcd.io/namespace: kube-system
