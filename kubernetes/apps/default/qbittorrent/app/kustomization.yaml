---
# yaml-language-server: $schema=https://json.schemastore.org/kustomization
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - ./qbittorrent-secret.yaml
  - ../../../../templates/volsync/claim.yaml
  - ../../../../templates/volsync/minio.yaml
  - ./qbitrr-pvc.yaml
  - ./helmrelease.yaml
configMapGenerator:
  - name: qbitrr-config
    files:
      - ./config/qbitrr/config.toml
  - name: gluetun-config
    files:
      - ./config/gluetun/config.toml
generatorOptions:
  disableNameSuffixHash: true
vars:
  - name: SONARR_API_KEY
    objref:
      kind: Secret
      name: sonarr-secret
    fieldref:
      fieldpath: data.SONARR_API_KEY
  - name: RADARR_API_KEY
    objref:
      kind: Secret
      name: radarr-secret
    fieldref:
      fieldpath: data.RADARR_API_KEY

patches:
  - patch: |
      - op: replace
        path: /data/config.toml
        value: $(SONARR_API_KEY)
    target:
      kind: ConfigMap
      name: qbitrr-config
  - patch: |
      - op: replace
        path: /data/config.toml
        value: $(RADARR_API_KEY)
    target:
      kind: ConfigMap
      name: qbitrr-config
