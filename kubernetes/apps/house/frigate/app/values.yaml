---
# yaml-language-server: $schema=https://raw.githubusercontent.com/bjw-s/helm-charts/aee0d999ba805fc55c3989dd454b0b5116333079/charts/library/common/values.schema.json
controllers:
  frigate:
    strategy: RollingUpdate
    pod:
      nodeSelector:
        kubernetes.io/hostname: "posey"
    containers:
      app:
        image:
          repository: ghcr.io/blakeblackshear/frigate
          tag: 0.15.0@sha256:dc77295ccc5a7258510ab6b1d9d5b7a339027305e2d29224338534febc4d1e89
        env:
          YOLO_MODELS: yolov7x-320
        envFrom:
          - secretRef:
              name: frigate-secret
        securityContext:
          allowPrivilegeEscalation: true
          readOnlyRootFilesystem: false
          privileged: true
        resources:
          requests:
            cpu: 1000m
            memory: 2Gi
          limits:
            memory: 6Gi
defaultPodOptions:
  securityContext:
    runAsNonRoot: false
    runAsUser: 0
    runAsGroup: 0
    fsGroupChangePolicy: OnRootMismatch
    seccompProfile: { type: RuntimeDefault }
service:
  main:
    controller: ${APP}
    type: ClusterIP
    ports:
      http-auth:
        port: &http-auth 8971
        targetPort: *http-auth
      http:
        primary: true
        port: &http 5000
        targetPort: *http
      rtsp:
        port: &rtsp 8554
        targetPort: *rtsp
      webrtc:
        port: &webrtc 8555
        targetPort: *webrtc
persistence:
  config:
    existingClaim: frigate-config
    globalMounts:
      - path: /config
  config-file:
    enabled: true
    name: frigate-config
    type: configMap
    globalMounts:
      - path: /config/config.yml
        subPath: frigate-config.yml
        readOnly: true
  media:
    existingClaim: frigate-media
    globalMounts:
      - path: /media/frigate
  shm:
    enabled: true
    type: emptyDir
    globalMounts:
      - path: /dev/shm
  cache:
    type: emptyDir
    globalMounts:
      - path: /tmp/cache
