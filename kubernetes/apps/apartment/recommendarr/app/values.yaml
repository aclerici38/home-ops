---
# yaml-language-server: $schema=https://raw.githubusercontent.com/bjw-s/helm-charts/aee0d999ba805fc55c3989dd454b0b5116333079/charts/library/common/values.schema.json
controllers:
  main:
    pod:
      securityContext:
        runAsUser: 65534
        runAsGroup: 65534
        fsGroup: 65534
        runAsNonRoot: true
        seccompProfile: { type: RuntimeDefault }
        fsGroupChangePolicy: Always
    containers:
      *app :
        image:
          repository: docker.io/tannermiddleton/recommendarr
          tag: v1.3.0@sha256:dd655316e5973eaa9809025a7780acb29304b589c37f45fd01c7294a7d816f12
        env:
          PUBLIC_URL: https://recomendarr.${SECRET_DOMAIN}
          DOCKER_ENV: true
          PORT: &port 3000
          FORCE_SECURE_COOKIES: true
        probes:
          liveness:
            enabled: true
          readiness:
            enabled: true
        securityContext:
          readOnlyRootFilesystem: true
          capabilities:
            drop:
              - ALL
          allowPrivilegeEscalation: false
        resources:
          limits:
            memory: 200Mi
          requests:
            cpu: 10m
            memory: 50Mi
service:
  *app :
    controller: main
    ports:
      http:
        port: *port
route:
  *app :
    hostnames:
      - ${APP}.${SECRET_DOMAIN}
    parentRefs:
      - name: internal
        namespace: kube-system
        sectionName: https
    rules:
      - backendRefs:
          - name: *app
            port: *port
persistence:
  data:
    existingClaim: *app
    globalMounts:
      - path: /app/server/data
