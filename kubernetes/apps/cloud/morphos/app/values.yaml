---
# yaml-language-server: $schema=https://raw.githubusercontent.com/bjw-s/helm-charts/aee0d999ba805fc55c3989dd454b0b5116333079/charts/library/common/values.schema.json
controllers:
  main:
    containers:
      *app :
        image:
          repository: ghcr.io/danvergara/morphos-server
          tag: 0.6.0@sha256:3d6f64ef386cbb6a7c5d55526e1a69da2d3661a1996d757897e92bf4369088f5
        resources:
          requests:
            cpu: 100m
          limits:
            memory: 500Mi
        securityContext:
          runAsUser: 65534
          runAsGroup: 65534
          runAsNonRoot: true
          allowPrivilegeEscalation: false
          seccompProfile: { type: RuntimeDefault }
          capabilities:
            drop:
              - ALL
service:
  *app :
    controller: main
    ports:
      http:
        port: &port 8080
route:
  *app :
    hostnames:
      - ${APP}.${SECRET_DOMAIN}
    parentRefs:
      - name: internal
        namespace: kube-system
        sectionName: https
    rules:
      - backendRefs:
          - name: *app
            port: *port
persistence:
  cache:
    type: emptyDir
    globalMounts:
      - path: /tmp
