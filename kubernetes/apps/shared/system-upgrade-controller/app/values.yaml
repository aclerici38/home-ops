---
# yaml-language-server: $schema=https://raw.githubusercontent.com/bjw-s/helm-charts/aee0d999ba805fc55c3989dd454b0b5116333079/charts/library/common/values.schema.json
controllers:
  system-upgrade-controller:
    strategy: RollingUpdate
    replicas: 2
    pod:
      securityContext:
        runAsNonRoot: true
        runAsUser: 65534
        runAsGroup: 65534
      tolerations:
        - key: CriticalAddonsOnly
          operator: Exists
        - key: node-role.kubernetes.io/control-plane
          operator: Exists
          effect: NoSchedule
        - key: node-role.kubernetes.io/master
          operator: Exists
          effect: NoSchedule

    containers:
      app:
        image:
          repository: docker.io/rancher/system-upgrade-controller
          tag: v0.15.2
        env:
          SYSTEM_UPGRADE_CONTROLLER_LEADER_ELECT: true
          SYSTEM_UPGRADE_CONTROLLER_NAME: system-upgrade-controller
          SYSTEM_UPGRADE_CONTROLLER_NAMESPACE:
            valueFrom:
              fieldRef:
                fieldPath: metadata.namespace
          SYSTEM_UPGRADE_CONTROLLER_NODE_NAME:
            valueFrom:
              fieldRef:
                fieldPath: spec.nodeName
          SYSTEM_UPGRADE_JOB_BACKOFF_LIMIT: "99"
          SYSTEM_UPGRADE_JOB_PRIVILEGED: false
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          capabilities:
            drop:
              - ALL
          seccompProfile:
            type: RuntimeDefault

serviceAccount:
  create: true
  name: system-upgrade-controller
