---
apiVersion: gateway.kgateway.dev/v1alpha1
kind: GatewayExtension
metadata:
  name: ${APP}-jwt
spec:
  jwt:
    validationMode: Strict
    providers:
      - name: pocket-id
        issuer: "https://id.${SECRET_DOMAIN}"
        tokenSource:
          header:
            header: Authorization
            prefix: "Bearer "
        jwks:
          remote:
            url: "https://id.${SECRET_DOMAIN}/.well-known/jwks.json"
            # Why is this required??
            backendRef:
              group: gateway.kgateway.dev
              kind: Backend
              name: ${APP}-oauth-backend
        claimsToHeaders:
          - name: preferred_username
            header: x-forwarded-user
