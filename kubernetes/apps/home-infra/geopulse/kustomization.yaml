---
# yaml-language-server: $schema=https://json.schemastore.org/kustomization
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
generatorOptions:
  disableNameSuffixHash: true
configMapGenerator:
  - name: APP-app-vars
    literals:
      - APP=geopulse
      - CNPG_POOLMODE=session
patches:
  - path: ./patch.yaml
    target:
      kind: Kustomization
      group: kustomize.toolkit.fluxcd.io
  - patch: |-
      - op: add
        path: /spec/externalSecretSpec/dataFrom/-
        value:
          extract:
          key: ${APP}-ai-encryption-key
      - op: add
        path: /spec/externalSecretSpec/dataFrom/-
        value:
          extract:
          key: ${APP}-jwt-public-key
      - op: add
        path: /spec/externalSecretSpec/dataFrom/-
        value:
          extract:
          key: ${APP}-jwt-private-key
    target:
      kind: ClusterExternalSecret
components:
  - ../../../components/ks/app
  - ../../../components/kustomize/external-secret
  - ../../../components/kustomize/cnpg/init
