---
apiVersion: kustomize.toolkit.fluxcd.io/v1
kind: Kustomization
metadata:
  name: patch
spec:
  patches:
    - patch: |-
        apiVersion: postgresql.cnpg.io/v1
        kind: Cluster
        metadata:
          name: patch
        spec:
          postgresql:
            extensions:
              - name: postgis
                ld_library_path:
                  - system
                image:
                  reference: ghcr.io/cloudnative-pg/postgis-extension-testing:3.6.1-18-trixie@sha256:295527c9e4be1df836e3b43ca1c78022483f2e3dd9ef80bd306256bdaa9ea2f5
      target:
        kind: Cluster
    - patch: |-
        - op: add
          path: /spec/externalSecretSpec/dataFrom/-
          value:
            extract:
              key: ${APP}-ai-encryption-key
        - op: add
          path: /spec/externalSecretSpec/dataFrom/-
          value:
            extract:
              key: ${APP}-jwt-public-key
        - op: add
          path: /spec/externalSecretSpec/dataFrom/-
          value:
            extract:
              key: ${APP}-jwt-private-key
      target:
        kind: ClusterExternalSecret
