---
apiVersion: kustomize.toolkit.fluxcd.io/v1
kind: Kustomization
metadata:
  name: patch
spec:
  postBuild:
    substitute:
      CNPG_POOLMODE: session
  patches:
    # Add cnpg db auth secret to grafana's ns
    - patch: |
        - op: add
          path: /spec/namespaceSelectors/-
          value:
            matchLabels:
              kubernetes.io/metadata.name: observability
      target:
        kind: ClusterExternalSecret
        labelSelector: dormammu.io/component=cnpg
