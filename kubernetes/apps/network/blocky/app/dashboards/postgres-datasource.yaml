---
# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/grafana.integreatly.org/grafanadatasource_v1beta1.json
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDatasource
metadata:
  name: blocky-postgres
  labels:
    grafana.internal/instance: grafana
spec:
  allowCrossNamespaceImport: true
  instanceSelector:
    matchLabels:
      grafana.internal/instance: grafana
  datasource:
    access: proxy
    name: blocky-postgres
    type: postgres
    url: $${host}:$${port}
    user: $${user}
    jsonData:
      database: $${dbname}
    secureJsonData:
      password: $${password}
  valuesFrom:
    - targetPath: url
      valueFrom:
        secretKeyRef:
          name: blocky-db-app
          key: host
    - targetPath: url
      valueFrom:
        secretKeyRef:
          name: blocky-db-app
          key: port
    - targetPath: user
      valueFrom:
        secretKeyRef:
          name: blocky-db-app
          key: user
    - targetPath: database
      valueFrom:
        secretKeyRef:
          name: blocky-db-app
          key: dbname
    - targetPath: secureJsonData.password
      valueFrom:
        secretKeyRef:
          name: blocky-db-app
          key: password
